<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>{% block title %}CEFR Level{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Nunito', sans-serif; }

        /* DUOLINGO-INSPIRED COLOR PALETTE */
        :root {
            --duo-green: #58CC02;
            --duo-green-dark: #46A302;
            --duo-green-light: #7ED321;
            --duo-blue: #1CB0F6;
            --duo-blue-dark: #1899D6;
            --duo-purple: #CE82FF;
            --duo-purple-dark: #A560E8;
            --duo-red: #FF4B4B;
            --duo-red-dark: #EA2B2B;
            --duo-orange: #FF9600;
            --duo-orange-dark: #E68600;
            --duo-yellow: #FFC800;
            --duo-yellow-dark: #E6B400;
            --duo-pink: #FF86D0;
            
            /* Background colors */
            --bg-main: #131F24;
            --bg-card: #1A2C32;
            --bg-card-hover: #233940;
            --border-color: #2B4148;
            --border-light: #3D5A63;
            
            /* Text colors */
            --text-white: #FFFFFF;
            --text-light: #AFAFAF;
            --text-muted: #777777;
        }

        body { 
            background: var(--bg-main);
            min-height: 100vh;
        }

        /* DUOLINGO 3D BUTTONS */
        .btn-duo {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 14px 28px;
            border: none;
            border-radius: 16px;
            font-weight: 800;
            font-size: 15px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            cursor: pointer;
            transition: all 0.1s ease;
            text-decoration: none;
            color: white;
        }
        
        .btn-duo-green {
            background: var(--duo-green);
            box-shadow: 0 5px 0 var(--duo-green-dark), 0 7px 15px rgba(88, 204, 2, 0.35);
        }
        .btn-duo-green:hover {
            filter: brightness(1.05);
            transform: translateY(-2px);
            box-shadow: 0 7px 0 var(--duo-green-dark), 0 10px 20px rgba(88, 204, 2, 0.4);
        }
        .btn-duo-green:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 var(--duo-green-dark);
        }

        .btn-duo-blue {
            background: var(--duo-blue);
            box-shadow: 0 5px 0 var(--duo-blue-dark), 0 7px 15px rgba(28, 176, 246, 0.35);
        }
        .btn-duo-blue:hover {
            filter: brightness(1.05);
            transform: translateY(-2px);
            box-shadow: 0 7px 0 var(--duo-blue-dark), 0 10px 20px rgba(28, 176, 246, 0.4);
        }
        .btn-duo-blue:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 var(--duo-blue-dark);
        }

        .btn-duo-purple {
            background: var(--duo-purple);
            box-shadow: 0 5px 0 var(--duo-purple-dark), 0 7px 15px rgba(206, 130, 255, 0.35);
        }
        .btn-duo-purple:hover {
            filter: brightness(1.05);
            transform: translateY(-2px);
            box-shadow: 0 7px 0 var(--duo-purple-dark), 0 10px 20px rgba(206, 130, 255, 0.4);
        }
        .btn-duo-purple:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 var(--duo-purple-dark);
        }

        .btn-duo-orange {
            background: var(--duo-orange);
            box-shadow: 0 5px 0 var(--duo-orange-dark), 0 7px 15px rgba(255, 150, 0, 0.35);
        }
        .btn-duo-orange:hover {
            filter: brightness(1.05);
            transform: translateY(-2px);
            box-shadow: 0 7px 0 var(--duo-orange-dark), 0 10px 20px rgba(255, 150, 0, 0.4);
        }
        .btn-duo-orange:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 var(--duo-orange-dark);
        }

        .btn-duo-red {
            background: var(--duo-red);
            box-shadow: 0 5px 0 var(--duo-red-dark), 0 7px 15px rgba(255, 75, 75, 0.35);
        }
        .btn-duo-red:hover {
            filter: brightness(1.05);
            transform: translateY(-2px);
            box-shadow: 0 7px 0 var(--duo-red-dark), 0 10px 20px rgba(255, 75, 75, 0.4);
        }
        .btn-duo-red:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 var(--duo-red-dark);
        }

        .btn-duo-outline {
            background: transparent;
            border: 2px solid var(--border-light);
            color: var(--text-light);
            box-shadow: none;
        }
        .btn-duo-outline:hover {
            background: var(--bg-card-hover);
            border-color: var(--duo-blue);
            color: white;
            transform: translateY(-2px);
        }

        /* SIDEBAR - Duolingo Style */
        .sidebar {
            width: 280px;
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            background: var(--bg-card);
            border-right: 2px solid var(--border-color);
            z-index: 40;
            display: flex;
            flex-direction: column;
        }

        .main-content {
            margin-left: 280px;
            min-height: 100vh;
            padding-bottom: 20px;
        }

        @media (max-width: 1023px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding-bottom: 100px; }
        }

        .main-content-full { margin-left: 0; padding-bottom: 120px; }

        /* NAV LINKS - Duolingo style */
        .nav-link {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 24px;
            margin: 4px 12px;
            color: var(--text-light);
            text-decoration: none;
            font-size: 16px;
            font-weight: 700;
            border-radius: 14px;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .nav-link:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-light);
            color: white;
        }

        .nav-link.active {
            background: rgba(88, 204, 2, 0.15);
            border-color: rgba(88, 204, 2, 0.4);
            color: var(--duo-green);
        }

        .nav-link svg {
            width: 28px;
            height: 28px;
            flex-shrink: 0;
        }

        /* MOBILE BOTTOM NAV */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 50;
            background: var(--bg-card);
            border-top: 2px solid var(--border-color);
            padding-bottom: env(safe-area-inset-bottom);
        }

        @media (max-width: 1023px) {
            .mobile-nav {
                display: flex;
                justify-content: space-around;
                align-items: center;
                height: 80px;
            }
        }

        .mobile-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 8px 16px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 11px;
            font-weight: 700;
            transition: all 0.2s;
            border-radius: 12px;
        }

        .mobile-link:hover,
        .mobile-link.active {
            color: var(--duo-green);
        }

        .mobile-link.active {
            background: rgba(88, 204, 2, 0.1);
        }

        .mobile-link svg {
            width: 28px;
            height: 28px;
        }

        /* CARDS - Duolingo style */
        .duo-card {
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            transition: all 0.2s ease;
        }

        .duo-card:hover {
            border-color: var(--border-light);
            transform: translateY(-2px);
        }

        /* STAT CARDS */
        .stat-card {
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.2s ease;
        }
        .stat-card:hover {
            transform: scale(1.02);
            border-color: var(--duo-green);
        }

        /* LEVEL BADGES - Colorful Duolingo style */
        .level-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 20px;
            border-radius: 30px;
            font-weight: 800;
            font-size: 14px;
            letter-spacing: 1px;
        }
        .level-a1, .level-a2 { background: var(--duo-green); color: white; }
        .level-b1 { background: var(--duo-blue); color: white; }
        .level-b2 { background: var(--duo-purple); color: white; }
        .level-c1 { background: var(--duo-orange); color: white; }
        .level-c2 { background: var(--duo-yellow); color: #1A2C32; }

        /* PROGRESS BAR - Duolingo style */
        .duo-progress {
            height: 16px;
            background: var(--border-color);
            border-radius: 10px;
            overflow: hidden;
        }
        .duo-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--duo-green) 0%, var(--duo-green-light) 100%);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* XP/STREAK BADGE */
        .xp-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 200, 0, 0.15);
            border: 2px solid rgba(255, 200, 0, 0.3);
            border-radius: 30px;
            padding: 6px 14px;
            font-weight: 800;
            font-size: 14px;
            color: var(--duo-yellow);
        }

        /* ANIMATIONS */
        @keyframes bounce-in {
            0% { transform: scale(0.9); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        .bounce-in { animation: bounce-in 0.4s ease-out; }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .float-animation { animation: float 3s ease-in-out infinite; }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--bg-main); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--border-light); }

        /* Gradient text */
        .gradient-text-green {
            background: linear-gradient(135deg, var(--duo-green) 0%, var(--duo-green-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Legacy support */
        .app-card { @apply duo-card; }
        .btn-3d { @apply btn-duo btn-duo-green; }
        .btn-3d-blue { @apply btn-duo btn-duo-blue; }
    </style>
    {% block head %}{% endblock %}
</head>
<body class="min-h-screen text-white {% if hide_nav %}results-page{% endif %}">
    <!-- Desktop Sidebar (natija sahifasida ko'rinmaydi) -->
    {% if not hide_nav %}
    <aside class="sidebar hidden lg:flex flex-col">
        <!-- Logo -->
        <div class="p-6 mb-2">
            <div class="flex items-center gap-3">
                <div class="w-14 h-14 bg-[#58CC02] rounded-2xl flex items-center justify-center text-white font-black text-2xl shadow-lg" style="box-shadow: 0 4px 0 #46A302;">
                    C
                </div>
                <div>
                    <span class="text-2xl font-black text-white">CEFR</span>
                    <span class="text-2xl font-black gradient-text-green">Level</span>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 py-4">
            <a href="/dashboard" class="nav-link {% if request.url.path == '/dashboard' or request.url.path == '/start' %}active{% endif %}">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                </svg>
                <span>{% if lang == 'uz' %}Dashboard{% else %}Dashboard{% endif %}</span>
            </a>

            <a href="/practice" class="nav-link {% if request.url.path == '/practice' %}active{% endif %}">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72L12 15l5-2.73v3.72z"/>
                </svg>
                <span>{% if lang == 'uz' %}Mashq{% else %}Practice{% endif %}</span>
            </a>

            <a href="/info" class="nav-link {% if request.url.path == '/info' %}active{% endif %}">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                </svg>
                <span>{% if lang == 'uz' %}Ma'lumot{% else %}Info{% endif %}</span>
            </a>

            <a href="/profile" class="nav-link {% if request.url.path == '/profile' %}active{% endif %}">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
                <span>{% if lang == 'uz' %}Profil{% else %}Profile{% endif %}</span>
            </a>
        </nav>

        <!-- User Card -->
        {% if user %}
        <div class="p-4 border-t-2 border-[#2B4148]">
            <div class="duo-card p-4">
                <div class="flex items-center gap-3">
                    {% if user.avatar %}
                    <img src="{{ user.avatar }}" alt="" class="w-12 h-12 rounded-full border-3 border-[#58CC02]">
                    {% else %}
                    <div class="w-12 h-12 rounded-full bg-[#58CC02] flex items-center justify-center text-white text-lg font-bold" style="box-shadow: 0 3px 0 #46A302;">
                        {{ (user.name or user.email)[0]|upper }}
                    </div>
                    {% endif %}
                    <div class="flex-1 min-w-0">
                        <div class="text-sm font-bold text-white truncate">{{ user.name or user.email.split('@')[0] }}</div>
                        <div class="xp-badge mt-1">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                            </svg>
                            {{ (user.free_tests or 0) + (user.purchased_tests or 0) }} {% if lang == 'uz' %}test{% else %}tests{% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </aside>
    {% endif %}

    <!-- Main Content -->
    <main class="main-content {% if hide_nav %}main-content-full{% endif %}">
        {% block content %}{% endblock %}
    </main>

    <!-- Mobile Bottom Navigation (natija sahifasida ko'rinmaydi) -->
    {% if not hide_nav %}
    <nav class="mobile-nav">
        <a href="/dashboard" class="mobile-link {% if request.url.path == '/dashboard' or request.url.path == '/start' %}active{% endif %}">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
            </svg>
            <span>{% if lang == 'uz' %}Dashboard{% else %}Home{% endif %}</span>
        </a>

        <a href="/practice" class="mobile-link {% if request.url.path == '/practice' %}active{% endif %}">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72L12 15l5-2.73v3.72z"/>
            </svg>
            <span>{% if lang == 'uz' %}Mashq{% else %}Practice{% endif %}</span>
        </a>

        <a href="/info" class="mobile-link {% if request.url.path == '/info' %}active{% endif %}">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
            </svg>
            <span>Info</span>
        </a>

        <a href="/profile" class="mobile-link {% if request.url.path == '/profile' %}active{% endif %}">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
            <span>{% if lang == 'uz' %}Profil{% else %}Profile{% endif %}</span>
        </a>
    </nav>
    {% endif %}

    {% block scripts %}{% endblock %}
</body>
</html>
